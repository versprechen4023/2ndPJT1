<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ems.icemile.mappers.headMapper">

	<select id="getNewRSCode" resultType="java.lang.String">	
  	SELECT result_code
  		FROM result
  			ORDER BY result_code desc
  				LIMIT 1
  	</select>
  	
  	<insert id="resultInsert">
	INSERT INTO result(result_code, work_code, line_code, prod_code, good_prod, faulty_prod, faulty_reason, remark, order_amount, rs_process, done_date)
		VALUES(CONCAT(‘RS’, LPAD(#{result_code}, 4, '0')),#{result_code},
			#{work_code},#{line_code},#{prod_code},#{good_prod},#{faulty_prod},#{faulty_reason}, #{remark}, #{order_amount}, #{rs_process}, #{done_date})
	</insert>

	<select id="getResultList" resultType="ems.icemile.dto.ResultDTO">
		SELECT * 
			FROM result
	</select>
	
	<select id="resultSearch" resultType="ems.icemile.dto.ResultDTO">
  	<bind name="content" value="'%' + content + '%'"/>
  	SELECT *
  		FROM result
			<where>
				<if test="rs_process != null and rs_process != ''">
					AND rs_process = #{rs_process}
				</if>
				<if test="content != null and content != ''">
					AND raw_name LIKE #{content}
				</if>
				<if test="done_dateBegin != null and done_dateBegin != '' and done_dateEnd != null and done_dateEnd != ''">
            		AND done_date BETWEEN #{done_dateBegin} AND #{rawOrderEnd}
        		</if>
        		<if test="done_dateBegin != null and done_dateBegin != ''">
            		AND done_date >= #{done_dateBegin}
        		</if>
        	</where>
  	</select>
  	
  	<update id="resultUpdate">
 	UPDATE result
 		SET faulty_prod = #{faulty_prod}, good_prod = #{good_prod}, faulty_reason = #{faulty_reason}, rs_process = #{rs_process}, remark = ${remark}
 			WHERE result_code = #{result_code}
 </update>
	
</mapper>